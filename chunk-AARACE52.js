import{a as re}from"./chunk-DEJI4HZG.js";import{f as ce,g as de,h as Tt,i as me,j as le,k as ue,l as be,m as it,n as pe,o as fe,p as ge,q as he,r as Lt,t as Y,u as ve,v as Dt,z as _e}from"./chunk-RRCAZJL3.js";import{K as se,h as ae,j as Ct,m as oe,p as Pt,r as It,v as Ot}from"./chunk-MRU5PUU6.js";import{$a as p,Ab as b,Bb as B,Ca as X,Cb as N,D as ct,Da as lt,Db as R,Dc as xt,Ea as Gt,Ec as yt,F as G,Fb as k,Fc as ee,Gb as f,Gc as ne,Hb as pt,Ib as J,J as Yt,Jb as ft,Jc as Mt,Kb as tt,L as dt,Lb as z,Mb as j,N as O,Nb as Kt,Nc as ie,O as Ut,Ob as m,Pb as T,Qb as P,Rc as Bt,Sb as gt,Sc as wt,Tb as ht,Ub as vt,Va as K,Vb as Jt,Vc as H,W as mt,Wb as _t,Wc as Nt,X as Ft,Xc as kt,Y as M,_a as r,a as v,b as C,ba as $t,bb as jt,ca as L,ea as Z,f as Ht,g as rt,ga as Qt,ha as Rt,hb as ut,jb as Zt,l as E,la as I,m as st,ma as F,mb as bt,mc as et,n as At,na as q,oa as zt,pc as nt,q as w,qb as g,rb as V,sb as d,u as A,ub as D,va as _,vb as S,vc as te,wa as x,xa as Wt,xb as Xt,yb as s,zb as c}from"./chunk-CXH3PM2I.js";var ze=["mat-menu-item",""],je=[[["mat-icon"],["","matMenuItemIcon",""]],"*"],Be=["mat-icon, [matMenuItemIcon]","*"];function Ne(a,l){a&1&&(Wt(),s(0,"svg",2),b(1,"polygon",3),c())}var Le=["*"];function qe(a,l){if(a&1){let t=R();s(0,"div",0),k("keydown",function(n){_(t);let i=f();return x(i._handleKeydown(n))})("click",function(){_(t);let n=f();return x(n.closed.emit("click"))})("@transformMenu.start",function(n){_(t);let i=f();return x(i._onAnimationStart(n))})("@transformMenu.done",function(n){_(t);let i=f();return x(i._onAnimationDone(n))}),s(1,"div",1),J(2),c()()}if(a&2){let t=f();S(t._classList),d("id",t.panelId)("@transformMenu",t._panelAnimationState),V("aria-label",t.ariaLabel||null)("aria-labelledby",t.ariaLabelledby||null)("aria-describedby",t.ariaDescribedby||null)}}var qt=new Z("MAT_MENU_PANEL"),at=(()=>{class a{constructor(t,e,n,i,o){this._elementRef=t,this._document=e,this._focusMonitor=n,this._parentMenu=i,this._changeDetectorRef=o,this.role="menuitem",this.disabled=!1,this.disableRipple=!1,this._hovered=new E,this._focused=new E,this._highlighted=!1,this._triggersSubmenu=!1,i?.addItem?.(this)}focus(t,e){this._focusMonitor&&t?this._focusMonitor.focusVia(this._getHostElement(),t,e):this._getHostElement().focus(e),this._focused.next(this)}ngAfterViewInit(){this._focusMonitor&&this._focusMonitor.monitor(this._elementRef,!1)}ngOnDestroy(){this._focusMonitor&&this._focusMonitor.stopMonitoring(this._elementRef),this._parentMenu&&this._parentMenu.removeItem&&this._parentMenu.removeItem(this),this._hovered.complete(),this._focused.complete()}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._elementRef.nativeElement}_checkDisabled(t){this.disabled&&(t.preventDefault(),t.stopPropagation())}_handleMouseEnter(){this._hovered.next(this)}getLabel(){let t=this._elementRef.nativeElement.cloneNode(!0),e=t.querySelectorAll("mat-icon, .material-icons");for(let n=0;n<e.length;n++)e[n].remove();return t.textContent?.trim()||""}_setHighlighted(t){this._highlighted=t,this._changeDetectorRef?.markForCheck()}_setTriggersSubmenu(t){this._triggersSubmenu=t,this._changeDetectorRef?.markForCheck()}_hasFocus(){return this._document&&this._document.activeElement===this._getHostElement()}static{this.\u0275fac=function(e){return new(e||a)(p(X),p(te),p(Lt),p(qt,8),p(et))}}static{this.\u0275cmp=F({type:a,selectors:[["","mat-menu-item",""]],hostAttrs:[1,"mat-mdc-menu-item","mat-mdc-focus-indicator"],hostVars:8,hostBindings:function(e,n){e&1&&k("click",function(o){return n._checkDisabled(o)})("mouseenter",function(){return n._handleMouseEnter()}),e&2&&(V("role",n.role)("tabindex",n._getTabIndex())("aria-disabled",n.disabled)("disabled",n.disabled||null),D("mat-mdc-menu-item-highlighted",n._highlighted)("mat-mdc-menu-item-submenu-trigger",n._triggersSubmenu))},inputs:{role:"role",disabled:[I.HasDecoratorInputTransform,"disabled","disabled",nt],disableRipple:[I.HasDecoratorInputTransform,"disableRipple","disableRipple",nt]},exportAs:["matMenuItem"],standalone:!0,features:[bt,_t],attrs:ze,ngContentSelectors:Be,decls:5,vars:3,consts:[[1,"mat-mdc-menu-item-text"],["matRipple","",1,"mat-mdc-menu-ripple",3,"matRippleDisabled","matRippleTrigger"],["viewBox","0 0 5 10","focusable","false","aria-hidden","true",1,"mat-mdc-menu-submenu-icon"],["points","0,0 5,5 0,10"]],template:function(e,n){e&1&&(pt(je),J(0),s(1,"span",0),J(2,1),c(),b(3,"div",1),g(4,Ne,2,0,":svg:svg",2)),e&2&&(r(3),d("matRippleDisabled",n.disableRipple||n.disabled)("matRippleTrigger",n._getHostElement()),r(),Xt(4,n._triggersSubmenu?4:-1))},dependencies:[ve],encapsulation:2,changeDetection:0})}}return a})();var Ve=new Z("MatMenuContent");var St={transformMenu:Bt("transformMenu",[Nt("void",H({opacity:0,transform:"scale(0.8)"})),kt("void => enter",wt("120ms cubic-bezier(0, 0, 0.2, 1)",H({opacity:1,transform:"scale(1)"}))),kt("* => void",wt("100ms 25ms linear",H({opacity:0})))]),fadeInItems:Bt("fadeInItems",[Nt("showing",H({opacity:1})),kt("void => *",[H({opacity:0}),wt("400ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},oi=St.fadeInItems,ri=St.transformMenu,He=0,Ye=new Z("mat-menu-default-options",{providedIn:"root",factory:Ue});function Ue(){return{overlapTrigger:!1,xPosition:"after",yPosition:"below",backdropClass:"cdk-overlay-transparent-backdrop"}}var U=(()=>{class a{get xPosition(){return this._xPosition}set xPosition(t){this._xPosition=t,this.setPositionClasses()}get yPosition(){return this._yPosition}set yPosition(t){this._yPosition=t,this.setPositionClasses()}set panelClass(t){let e=this._previousPanelClass,n=v({},this._classList);e&&e.length&&e.split(" ").forEach(i=>{n[i]=!1}),this._previousPanelClass=t,t&&t.length&&(t.split(" ").forEach(i=>{n[i]=!0}),this._elementRef.nativeElement.className=""),this._classList=n}get classList(){return this.panelClass}set classList(t){this.panelClass=t}constructor(t,e,n,i){this._elementRef=t,this._ngZone=e,this._changeDetectorRef=i,this._elevationPrefix="mat-elevation-z",this._baseElevation=8,this._directDescendantItems=new Gt,this._classList={},this._panelAnimationState="void",this._animationDone=new E,this.closed=new lt,this.close=this.closed,this.panelId=`mat-menu-panel-${He++}`,this.overlayPanelClass=n.overlayPanelClass||"",this._xPosition=n.xPosition,this._yPosition=n.yPosition,this.backdropClass=n.backdropClass,this.overlapTrigger=n.overlapTrigger,this.hasBackdrop=n.hasBackdrop}ngOnInit(){this.setPositionClasses()}ngAfterContentInit(){this._updateDirectDescendants(),this._keyManager=new fe(this._directDescendantItems).withWrap().withTypeAhead().withHomeAndEnd(),this._keyManager.tabOut.subscribe(()=>this.closed.emit("tab")),this._directDescendantItems.changes.pipe(mt(this._directDescendantItems),Ft(t=>ct(...t.map(e=>e._focused)))).subscribe(t=>this._keyManager.updateActiveItem(t)),this._directDescendantItems.changes.subscribe(t=>{let e=this._keyManager;if(this._panelAnimationState==="enter"&&e.activeItem?._hasFocus()){let n=t.toArray(),i=Math.max(0,Math.min(n.length-1,e.activeItemIndex||0));n[i]&&!n[i].disabled?e.setActiveItem(i):e.setNextItemActive()}})}ngOnDestroy(){this._keyManager?.destroy(),this._directDescendantItems.destroy(),this.closed.complete(),this._firstItemFocusSubscription?.unsubscribe()}_hovered(){return this._directDescendantItems.changes.pipe(mt(this._directDescendantItems),Ft(e=>ct(...e.map(n=>n._hovered))))}addItem(t){}removeItem(t){}_handleKeydown(t){let e=t.keyCode,n=this._keyManager;switch(e){case 27:ue(t)||(t.preventDefault(),this.closed.emit("keydown"));break;case 37:this.parentMenu&&this.direction==="ltr"&&this.closed.emit("keydown");break;case 39:this.parentMenu&&this.direction==="rtl"&&this.closed.emit("keydown");break;default:(e===38||e===40)&&n.setFocusOrigin("keyboard"),n.onKeydown(t);return}t.stopPropagation()}focusFirstItem(t="program"){this._firstItemFocusSubscription?.unsubscribe(),this._firstItemFocusSubscription=this._ngZone.onStable.pipe(dt(1)).subscribe(()=>{let e=null;if(this._directDescendantItems.length&&(e=this._directDescendantItems.first._getHostElement().closest('[role="menu"]')),!e||!e.contains(document.activeElement)){let n=this._keyManager;n.setFocusOrigin(t).setFirstItemActive(),!n.activeItem&&e&&e.focus()}})}resetActiveItem(){this._keyManager.setActiveItem(-1)}setElevation(t){let e=Math.min(this._baseElevation+t,24),n=`${this._elevationPrefix}${e}`,i=Object.keys(this._classList).find(o=>o.startsWith(this._elevationPrefix));if(!i||i===this._previousElevation){let o=v({},this._classList);this._previousElevation&&(o[this._previousElevation]=!1),o[n]=!0,this._previousElevation=n,this._classList=o}}setPositionClasses(t=this.xPosition,e=this.yPosition){this._classList=C(v({},this._classList),{"mat-menu-before":t==="before","mat-menu-after":t==="after","mat-menu-above":e==="above","mat-menu-below":e==="below"}),this._changeDetectorRef?.markForCheck()}_startAnimation(){this._panelAnimationState="enter"}_resetAnimation(){this._panelAnimationState="void"}_onAnimationDone(t){this._animationDone.next(t),this._isAnimating=!1}_onAnimationStart(t){this._isAnimating=!0,t.toState==="enter"&&this._keyManager.activeItemIndex===0&&(t.element.scrollTop=0)}_updateDirectDescendants(){this._allItems.changes.pipe(mt(this._allItems)).subscribe(t=>{this._directDescendantItems.reset(t.filter(e=>e._parentMenu===this)),this._directDescendantItems.notifyOnChanges()})}static{this.\u0275fac=function(e){return new(e||a)(p(X),p(ut),p(Ye),p(et))}}static{this.\u0275cmp=F({type:a,selectors:[["mat-menu"]],contentQueries:function(e,n,i){if(e&1&&(ft(i,Ve,5),ft(i,at,5),ft(i,at,4)),e&2){let o;z(o=j())&&(n.lazyContent=o.first),z(o=j())&&(n._allItems=o),z(o=j())&&(n.items=o)}},viewQuery:function(e,n){if(e&1&&tt(jt,5),e&2){let i;z(i=j())&&(n.templateRef=i.first)}},hostVars:3,hostBindings:function(e,n){e&2&&V("aria-label",null)("aria-labelledby",null)("aria-describedby",null)},inputs:{backdropClass:"backdropClass",ariaLabel:[I.None,"aria-label","ariaLabel"],ariaLabelledby:[I.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[I.None,"aria-describedby","ariaDescribedby"],xPosition:"xPosition",yPosition:"yPosition",overlapTrigger:[I.HasDecoratorInputTransform,"overlapTrigger","overlapTrigger",nt],hasBackdrop:[I.HasDecoratorInputTransform,"hasBackdrop","hasBackdrop",t=>t==null?null:nt(t)],panelClass:[I.None,"class","panelClass"],classList:"classList"},outputs:{closed:"closed",close:"close"},exportAs:["matMenu"],standalone:!0,features:[Jt([{provide:qt,useExisting:a}]),bt,_t],ngContentSelectors:Le,decls:1,vars:0,consts:[["tabindex","-1","role","menu",1,"mat-mdc-menu-panel","mat-mdc-elevation-specific",3,"keydown","click","id"],[1,"mat-mdc-menu-content"]],template:function(e,n){e&1&&(pt(),g(0,qe,3,7,"ng-template"))},styles:['mat-menu{display:none}.mat-mdc-menu-content{margin:0;padding:8px 0;list-style-type:none}.mat-mdc-menu-content:focus{outline:none}.mat-mdc-menu-content,.mat-mdc-menu-content .mat-mdc-menu-item .mat-mdc-menu-item-text{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;flex:1;white-space:normal;font-family:var(--mat-menu-item-label-text-font);line-height:var(--mat-menu-item-label-text-line-height);font-size:var(--mat-menu-item-label-text-size);letter-spacing:var(--mat-menu-item-label-text-tracking);font-weight:var(--mat-menu-item-label-text-weight)}.mat-mdc-menu-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;box-sizing:border-box;outline:0;border-radius:var(--mat-menu-container-shape);background-color:var(--mat-menu-container-color);will-change:transform,opacity}.mat-mdc-menu-panel.ng-animating{pointer-events:none}.cdk-high-contrast-active .mat-mdc-menu-panel{outline:solid 1px}.mat-divider{color:var(--mat-menu-divider-color);margin-bottom:var(--mat-menu-divider-bottom-spacing);margin-top:var(--mat-menu-divider-top-spacing)}.mat-mdc-menu-item{display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;padding:0;padding-left:var(--mat-menu-item-leading-spacing);padding-right:var(--mat-menu-item-trailing-spacing);-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer;width:100%;text-align:left;box-sizing:border-box;color:inherit;font-size:inherit;background:none;text-decoration:none;margin:0;align-items:center;min-height:48px}.mat-mdc-menu-item:focus{outline:none}[dir=rtl] .mat-mdc-menu-item,.mat-mdc-menu-item[dir=rtl]{padding-left:var(--mat-menu-item-trailing-spacing);padding-right:var(--mat-menu-item-leading-spacing)}.mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]){padding-left:var(--mat-menu-item-with-icon-leading-spacing);padding-right:var(--mat-menu-item-with-icon-trailing-spacing)}[dir=rtl] .mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon]),.mat-mdc-menu-item:has(.material-icons,mat-icon,[matButtonIcon])[dir=rtl]{padding-left:var(--mat-menu-item-with-icon-trailing-spacing);padding-right:var(--mat-menu-item-with-icon-leading-spacing)}.mat-mdc-menu-item::-moz-focus-inner{border:0}.mat-mdc-menu-item,.mat-mdc-menu-item:visited,.mat-mdc-menu-item:link{color:var(--mat-menu-item-label-text-color)}.mat-mdc-menu-item .mat-icon-no-color,.mat-mdc-menu-item .mat-mdc-menu-submenu-icon{color:var(--mat-menu-item-icon-color)}.mat-mdc-menu-item[disabled]{cursor:default;opacity:.38}.mat-mdc-menu-item[disabled]::after{display:block;position:absolute;content:"";top:0;left:0;bottom:0;right:0}.mat-mdc-menu-item .mat-icon{flex-shrink:0;margin-right:var(--mat-menu-item-spacing);height:var(--mat-menu-item-icon-size);width:var(--mat-menu-item-icon-size)}[dir=rtl] .mat-mdc-menu-item{text-align:right}[dir=rtl] .mat-mdc-menu-item .mat-icon{margin-right:0;margin-left:var(--mat-menu-item-spacing)}.mat-mdc-menu-item:not([disabled]):hover{background-color:var(--mat-menu-item-hover-state-layer-color)}.mat-mdc-menu-item:not([disabled]).cdk-program-focused,.mat-mdc-menu-item:not([disabled]).cdk-keyboard-focused,.mat-mdc-menu-item:not([disabled]).mat-mdc-menu-item-highlighted{background-color:var(--mat-menu-item-focus-state-layer-color)}.cdk-high-contrast-active .mat-mdc-menu-item{margin-top:1px}.mat-mdc-menu-submenu-icon{width:var(--mat-menu-item-icon-size);height:10px;fill:currentColor;padding-left:var(--mat-menu-item-spacing)}[dir=rtl] .mat-mdc-menu-submenu-icon{padding-right:var(--mat-menu-item-spacing);padding-left:0}[dir=rtl] .mat-mdc-menu-submenu-icon polygon{transform:scaleX(-1)}.cdk-high-contrast-active .mat-mdc-menu-submenu-icon{fill:CanvasText}.mat-mdc-menu-item .mat-mdc-menu-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}'],encapsulation:2,data:{animation:[St.transformMenu,St.fadeInItems]},changeDetection:0})}}return a})(),we=new Z("mat-menu-scroll-strategy",{providedIn:"root",factory:()=>{let a=Rt(it);return()=>a.scrollStrategies.reposition()}});function $e(a){return()=>a.scrollStrategies.reposition()}var Qe={provide:we,deps:[it],useFactory:$e},xe=ce({passive:!0});var ke=(()=>{class a{get _deprecatedMatMenuTriggerFor(){return this.menu}set _deprecatedMatMenuTriggerFor(t){this.menu=t}get menu(){return this._menu}set menu(t){t!==this._menu&&(this._menu=t,this._menuCloseSubscription.unsubscribe(),t&&(this._parentMaterialMenu,this._menuCloseSubscription=t.close.subscribe(e=>{this._destroyMenu(e),(e==="click"||e==="tab")&&this._parentMaterialMenu&&this._parentMaterialMenu.closed.emit(e)})),this._menuItemInstance?._setTriggersSubmenu(this.triggersSubmenu()))}constructor(t,e,n,i,o,u,h,y,$){this._overlay=t,this._element=e,this._viewContainerRef=n,this._menuItemInstance=u,this._dir=h,this._focusMonitor=y,this._ngZone=$,this._overlayRef=null,this._menuOpen=!1,this._closingActionsSubscription=rt.EMPTY,this._hoverSubscription=rt.EMPTY,this._menuCloseSubscription=rt.EMPTY,this._changeDetectorRef=Rt(et),this._handleTouchStart=Q=>{he(Q)||(this._openedBy="touch")},this._openedBy=void 0,this.restoreFocus=!0,this.menuOpened=new lt,this.onMenuOpen=this.menuOpened,this.menuClosed=new lt,this.onMenuClose=this.menuClosed,this._scrollStrategy=i,this._parentMaterialMenu=o instanceof U?o:void 0,e.nativeElement.addEventListener("touchstart",this._handleTouchStart,xe)}ngAfterContentInit(){this._handleHover()}ngOnDestroy(){this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=null),this._element.nativeElement.removeEventListener("touchstart",this._handleTouchStart,xe),this._menuCloseSubscription.unsubscribe(),this._closingActionsSubscription.unsubscribe(),this._hoverSubscription.unsubscribe()}get menuOpen(){return this._menuOpen}get dir(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}triggersSubmenu(){return!!(this._menuItemInstance&&this._parentMaterialMenu&&this.menu)}toggleMenu(){return this._menuOpen?this.closeMenu():this.openMenu()}openMenu(){let t=this.menu;if(this._menuOpen||!t)return;let e=this._createOverlay(t),n=e.getConfig(),i=n.positionStrategy;this._setPosition(t,i),n.hasBackdrop=t.hasBackdrop==null?!this.triggersSubmenu():t.hasBackdrop,e.attach(this._getPortal(t)),t.lazyContent&&t.lazyContent.attach(this.menuData),this._closingActionsSubscription=this._menuClosingActions().subscribe(()=>this.closeMenu()),this._initMenu(t),t instanceof U&&(t._startAnimation(),t._directDescendantItems.changes.pipe(M(t.close)).subscribe(()=>{i.withLockedPosition(!1).reapplyLastPosition(),i.withLockedPosition(!0)}))}closeMenu(){this.menu?.close.emit()}focus(t,e){this._focusMonitor&&t?this._focusMonitor.focusVia(this._element,t,e):this._element.nativeElement.focus(e)}updatePosition(){this._overlayRef?.updatePosition()}_destroyMenu(t){if(!this._overlayRef||!this.menuOpen)return;let e=this.menu;this._closingActionsSubscription.unsubscribe(),this._overlayRef.detach(),this.restoreFocus&&(t==="keydown"||!this._openedBy||!this.triggersSubmenu())&&this.focus(this._openedBy),this._openedBy=void 0,e instanceof U?(e._resetAnimation(),e.lazyContent?e._animationDone.pipe(G(n=>n.toState==="void"),dt(1),M(e.lazyContent._attached)).subscribe({next:()=>e.lazyContent.detach(),complete:()=>this._setIsMenuOpen(!1)}):this._setIsMenuOpen(!1)):(this._setIsMenuOpen(!1),e?.lazyContent?.detach())}_initMenu(t){t.parentMenu=this.triggersSubmenu()?this._parentMaterialMenu:void 0,t.direction=this.dir,this._setMenuElevation(t),t.focusFirstItem(this._openedBy||"program"),this._setIsMenuOpen(!0)}_setMenuElevation(t){if(t.setElevation){let e=0,n=t.parentMenu;for(;n;)e++,n=n.parentMenu;t.setElevation(e)}}_setIsMenuOpen(t){t!==this._menuOpen&&(this._menuOpen=t,this._menuOpen?this.menuOpened.emit():this.menuClosed.emit(),this.triggersSubmenu()&&this._menuItemInstance._setHighlighted(t),this._changeDetectorRef.markForCheck())}_createOverlay(t){if(!this._overlayRef){let e=this._getOverlayConfig(t);this._subscribeToPositions(t,e.positionStrategy),this._overlayRef=this._overlay.create(e),this._overlayRef.keydownEvents().subscribe()}return this._overlayRef}_getOverlayConfig(t){return new be({positionStrategy:this._overlay.position().flexibleConnectedTo(this._element).withLockedPosition().withGrowAfterOpen().withTransformOriginOn(".mat-menu-panel, .mat-mdc-menu-panel"),backdropClass:t.backdropClass||"cdk-overlay-transparent-backdrop",panelClass:t.overlayPanelClass,scrollStrategy:this._scrollStrategy(),direction:this._dir})}_subscribeToPositions(t,e){t.setPositionClasses&&e.positionChanges.subscribe(n=>{let i=n.connectionPair.overlayX==="start"?"after":"before",o=n.connectionPair.overlayY==="top"?"below":"above";this._ngZone?this._ngZone.run(()=>t.setPositionClasses(i,o)):t.setPositionClasses(i,o)})}_setPosition(t,e){let[n,i]=t.xPosition==="before"?["end","start"]:["start","end"],[o,u]=t.yPosition==="above"?["bottom","top"]:["top","bottom"],[h,y]=[o,u],[$,Q]=[n,i],W=0;if(this.triggersSubmenu()){if(Q=n=t.xPosition==="before"?"start":"end",i=$=n==="end"?"start":"end",this._parentMaterialMenu){if(this._parentInnerPadding==null){let Vt=this._parentMaterialMenu.items.first;this._parentInnerPadding=Vt?Vt._getHostElement().offsetTop:0}W=o==="bottom"?this._parentInnerPadding:-this._parentInnerPadding}}else t.overlapTrigger||(h=o==="top"?"bottom":"top",y=u==="top"?"bottom":"top");e.withPositions([{originX:n,originY:h,overlayX:$,overlayY:o,offsetY:W},{originX:i,originY:h,overlayX:Q,overlayY:o,offsetY:W},{originX:n,originY:y,overlayX:$,overlayY:u,offsetY:-W},{originX:i,originY:y,overlayX:Q,overlayY:u,offsetY:-W}])}_menuClosingActions(){let t=this._overlayRef.backdropClick(),e=this._overlayRef.detachments(),n=this._parentMaterialMenu?this._parentMaterialMenu.closed:w(),i=this._parentMaterialMenu?this._parentMaterialMenu._hovered().pipe(G(o=>o!==this._menuItemInstance),G(()=>this._menuOpen)):w();return ct(t,n,i,e)}_handleMousedown(t){ge(t)||(this._openedBy=t.button===0?"mouse":void 0,this.triggersSubmenu()&&t.preventDefault())}_handleKeydown(t){let e=t.keyCode;(e===13||e===32)&&(this._openedBy="keyboard"),this.triggersSubmenu()&&(e===39&&this.dir==="ltr"||e===37&&this.dir==="rtl")&&(this._openedBy="keyboard",this.openMenu())}_handleClick(t){this.triggersSubmenu()?(t.stopPropagation(),this.openMenu()):this.toggleMenu()}_handleHover(){!this.triggersSubmenu()||!this._parentMaterialMenu||(this._hoverSubscription=this._parentMaterialMenu._hovered().pipe(G(t=>t===this._menuItemInstance&&!t.disabled),O(0,At)).subscribe(()=>{this._openedBy="mouse",this.menu instanceof U&&this.menu._isAnimating?this.menu._animationDone.pipe(dt(1),O(0,At),M(this._parentMaterialMenu._hovered())).subscribe(()=>this.openMenu()):this.openMenu()}))}_getPortal(t){return(!this._portal||this._portal.templateRef!==t.templateRef)&&(this._portal=new le(t.templateRef,this._viewContainerRef)),this._portal}static{this.\u0275fac=function(e){return new(e||a)(p(it),p(X),p(Zt),p(we),p(qt,8),p(at,10),p(de,8),p(Lt),p(ut))}}static{this.\u0275dir=zt({type:a,selectors:[["","mat-menu-trigger-for",""],["","matMenuTriggerFor",""]],hostAttrs:[1,"mat-mdc-menu-trigger"],hostVars:3,hostBindings:function(e,n){e&1&&k("click",function(o){return n._handleClick(o)})("mousedown",function(o){return n._handleMousedown(o)})("keydown",function(o){return n._handleKeydown(o)}),e&2&&V("aria-haspopup",n.menu?"menu":null)("aria-expanded",n.menuOpen)("aria-controls",n.menuOpen?n.menu.panelId:null)},inputs:{_deprecatedMatMenuTriggerFor:[I.None,"mat-menu-trigger-for","_deprecatedMatMenuTriggerFor"],menu:[I.None,"matMenuTriggerFor","menu"],menuData:[I.None,"matMenuTriggerData","menuData"],restoreFocus:[I.None,"matMenuTriggerRestoreFocus","restoreFocus"]},outputs:{menuOpened:"menuOpened",onMenuOpen:"onMenuOpen",menuClosed:"menuClosed",onMenuClose:"onMenuClose"},exportAs:["matMenuTrigger"],standalone:!0})}}return a})(),Pe=(()=>{class a{static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275mod=q({type:a})}static{this.\u0275inj=L({providers:[Qe],imports:[Mt,Dt,Y,pe,me,Y]})}}return a})();var Ie=(()=>{class a{static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275mod=q({type:a})}static{this.\u0275inj=L({imports:[Y,Dt,Y]})}}return a})();var Et=(()=>{class a{constructor(t){this.workerService=t,this.threads=new st([]),this.typingStatus=new st([]),this.typingStatusSubject=new st([]),this.STORAGE_KEY="chat_threads",this.staticMessages={greeting:["\u0627\u0644\u0633\u0644\u0627\u0645 \u0639\u0644\u064A\u0643\u0645\u060C \u0643\u064A\u0641 \u064A\u0645\u0643\u0646\u0646\u064A \u0645\u0633\u0627\u0639\u062F\u062A\u0643\u061F","\u0623\u0647\u0644\u0627\u064B \u0628\u0643\u060C \u0647\u0644 \u062A\u062D\u062A\u0627\u062C \u0625\u0644\u0649 \u062E\u062F\u0645\u0629 \u0645\u0639\u064A\u0646\u0629\u061F","\u0645\u0631\u062D\u0628\u0627\u064B\u060C \u0623\u0646\u0627 \u0645\u062A\u0648\u0627\u062C\u062F \u0644\u0644\u0645\u0633\u0627\u0639\u062F\u0629"],service:["\u0633\u064A\u0643\u0648\u0646 \u0627\u0644\u0633\u0639\u0631 \u062D\u0648\u0627\u0644\u064A {price} \u062C\u0646\u064A\u0647. \u0647\u0644 \u064A\u0646\u0627\u0633\u0628\u0643 \u0647\u0630\u0627\u061F","\u064A\u0645\u0643\u0646\u0646\u064A \u0627\u0644\u0642\u062F\u0648\u0645 \u063A\u062F\u0627\u064B \u0641\u064A \u0627\u0644\u0635\u0628\u0627\u062D. \u0647\u0644 \u0647\u0630\u0627 \u0645\u0646\u0627\u0633\u0628\u061F","\u0633\u0623\u062D\u062A\u0627\u062C \u062D\u0648\u0627\u0644\u064A \u0633\u0627\u0639\u062A\u064A\u0646 \u0644\u0625\u0646\u0647\u0627\u0621 \u0627\u0644\u0639\u0645\u0644"],confirmation:["\u062A\u0645 \u062A\u0623\u0643\u064A\u062F \u0627\u0644\u0645\u0648\u0639\u062F \u0644\u064A\u0648\u0645 {date}","\u0633\u0623\u0635\u0644 \u0641\u064A \u0627\u0644\u0645\u0648\u0639\u062F \u0627\u0644\u0645\u062D\u062F\u062F \u0625\u0646 \u0634\u0627\u0621 \u0627\u0644\u0644\u0647","\u0634\u0643\u0631\u0627\u064B \u0644\u062B\u0642\u062A\u0643\u060C \u0633\u0623\u0643\u0648\u0646 \u0639\u0646\u062F \u062D\u0633\u0646 \u0638\u0646\u0643"],completion:["\u062A\u0645 \u0625\u0646\u062C\u0627\u0632 \u0627\u0644\u0639\u0645\u0644 \u0628\u062D\u0645\u062F \u0627\u0644\u0644\u0647","\u0623\u062A\u0645\u0646\u0649 \u0623\u0646 \u062A\u0643\u0648\u0646 \u0631\u0627\u0636\u064A\u0627\u064B \u0639\u0646 \u0627\u0644\u062E\u062F\u0645\u0629","\u064A\u0645\u0643\u0646\u0643 \u062A\u0642\u064A\u064A\u0645 \u0627\u0644\u062E\u062F\u0645\u0629 \u0645\u0646 \u062E\u0644\u0627\u0644 \u0627\u0644\u062A\u0637\u0628\u064A\u0642"],negotiation:["\u0647\u0644 \u064A\u0645\u0643\u0646\u0646\u0627 \u0627\u0644\u0627\u062A\u0641\u0627\u0642 \u0639\u0644\u0649 {price} \u062C\u0646\u064A\u0647\u061F","\u0627\u0644\u0633\u0639\u0631 \u0642\u0627\u0628\u0644 \u0644\u0644\u062A\u0641\u0627\u0648\u0636","\u064A\u0645\u0643\u0646\u0646\u064A \u062A\u0642\u062F\u064A\u0645 \u062E\u0635\u0645 10% \u0625\u0630\u0627 \u062A\u0645 \u0627\u0644\u062D\u062C\u0632 \u0627\u0644\u064A\u0648\u0645"]},this.staticServiceRequests=[{id:1,service:"\u0635\u064A\u0627\u0646\u0629 \u062A\u0643\u064A\u064A\u0641",status:"pending",details:"\u062A\u0646\u0638\u064A\u0641 \u0648\u0635\u064A\u0627\u0646\u0629 \u062F\u0648\u0631\u064A\u0629"},{id:2,service:"\u0633\u0628\u0627\u0643\u0629",status:"in_progress",details:"\u0625\u0635\u0644\u0627\u062D \u062A\u0633\u0631\u064A\u0628 \u0645\u064A\u0627\u0647"},{id:3,service:"\u0643\u0647\u0631\u0628\u0627\u0621",status:"completed",details:"\u062A\u0631\u0643\u064A\u0628 \u0645\u0635\u0627\u0628\u064A\u062D LED"}],this.loadInitialThreads()}loadInitialThreads(){return Ht(this,null,function*(){let e=(yield this.workerService.getWorkers().toPromise()).slice(0,5).map((n,i)=>({id:i+1,workerId:n.id,worker:n,unreadCount:Math.floor(Math.random()*3),status:"active",lastActivity:new Date(Date.now()-Math.random()*864e5*5),lastMessage:this.createInitialMessage(n),serviceRequest:this.getRandomServiceRequest()}));this.threads.next(e)})}getTypingStatus$(){return this.typingStatusSubject.asObservable()}sendTypingStatus(t,e){let n=this.typingStatus.value.filter(i=>i.threadId!==t||i.userId!==1);e&&n.push({threadId:t,userId:1,isTyping:e}),this.typingStatus.next(n),e&&setTimeout(()=>{this.sendTypingStatus(t,!1)},3e3)}sendMessage(t,e){let n={id:Date.now(),senderId:1,receiverId:t,content:e,timestamp:new Date,read:!1,type:"text"},i=this.threads.value,o=i.findIndex(u=>u.id===t);if(o!==-1){let u=[...i];u[o]=C(v({},u[o]),{lastMessage:n,lastActivity:new Date}),this.threads.next(u),setTimeout(()=>{let h={threadId:t,userId:u[o].workerId,isTyping:!0};this.typingStatus.next([...this.typingStatus.value,h]),setTimeout(()=>{this.simulateWorkerResponse(t,u[o]),this.typingStatus.next(this.typingStatus.value.filter(y=>y.threadId!==t||y.userId!==u[o].workerId))},Math.random()*2e3+1e3)},500)}return w(n).pipe(O(300))}simulateWorkerResponse(t,e){let n=this.getMessageType(e),i=this.staticMessages[n][Math.floor(Math.random()*this.staticMessages[n].length)].replace("{price}",(Math.floor(Math.random()*500)+100).toString()).replace("{date}",this.getRandomFutureDate()),o={id:Date.now(),senderId:e.workerId,receiverId:1,content:i,timestamp:new Date,read:!1,type:"text"},u=this.threads.value,h=u.findIndex(y=>y.id===t);if(h!==-1){let y=[...u];y[h]=C(v({},y[h]),{lastMessage:o,lastActivity:new Date,unreadCount:y[h].unreadCount+1}),this.threads.next(y)}}createInitialMessage(t){let e=["greeting","service","confirmation","completion","negotiation"],n=e[Math.floor(Math.random()*e.length)],i=this.staticMessages[n],o=i[Math.floor(Math.random()*i.length)];return o=o.replace("{price}",(Math.floor(Math.random()*500)+100).toString()).replace("{date}",this.getRandomFutureDate()),{id:Date.now(),senderId:t.id,receiverId:1,content:o,timestamp:new Date(Date.now()-Math.random()*864e5),read:Math.random()>.5,type:"text"}}getRandomServiceRequest(){if(Math.random()>.5)return this.staticServiceRequests[Math.floor(Math.random()*this.staticServiceRequests.length)]}getMessageHistory(t){let e=[],n=this.threads.value.find(i=>i.id===t);if(n){let i=this.generateConversation(n);e.push(...i),n.serviceRequest&&e.push({id:Date.now(),senderId:1,receiverId:n.workerId,content:"\u0637\u0644\u0628 \u062E\u062F\u0645\u0629 \u062C\u062F\u064A\u062F",timestamp:new Date(n.lastActivity.getTime()-864e5),read:!0,type:"service_request",serviceRequestId:n.serviceRequest.id})}return w(e.sort((i,o)=>new Date(i.timestamp).getTime()-new Date(o.timestamp).getTime())).pipe(O(500))}generateConversation(t){let e=[],n=Math.floor(Math.random()*10)+5,i=new Date(Date.now()-24*36e5);for(let o=0;o<n;o++){let u=o%2===0,h=o*(36e5*Math.random()),y=this.createConversationMessage(t,u,new Date(i.getTime()+h));e.push(y)}return e}createConversationMessage(t,e,n){let i=this.getMessageType(t),o=e?this.staticMessages[i][Math.floor(Math.random()*this.staticMessages[i].length)]:this.getCustomerResponse(i);return{id:Date.now(),senderId:e?t.workerId:1,receiverId:e?1:t.workerId,content:o.replace("{price}",(Math.floor(Math.random()*500)+100).toString()).replace("{date}",this.getRandomFutureDate()),timestamp:n,read:!0,type:"text"}}getMessageType(t){let e=["greeting","service","confirmation","completion","negotiation"];return e[Math.floor(Math.random()*e.length)]}getCustomerResponse(t){let e={greeting:["\u0648\u0639\u0644\u064A\u0643\u0645 \u0627\u0644\u0633\u0644\u0627\u0645\u060C \u0646\u0639\u0645 \u0623\u062D\u062A\u0627\u062C \u0645\u0633\u0627\u0639\u062F\u0629","\u0645\u0631\u062D\u0628\u0627\u064B\u060C \u0639\u0646\u062F\u064A \u0645\u0634\u0643\u0644\u0629 \u0623\u0631\u064A\u062F \u062D\u0644\u0647\u0627","\u0623\u0647\u0644\u0627\u064B\u060C \u0623\u0631\u064A\u062F \u0627\u0644\u0627\u0633\u062A\u0641\u0633\u0627\u0631 \u0639\u0646 \u0627\u0644\u062E\u062F\u0645\u0627\u062A \u0627\u0644\u0645\u062A\u0648\u0641\u0631\u0629"],service:["\u0646\u0639\u0645 \u0627\u0644\u0633\u0639\u0631 \u0645\u0646\u0627\u0633\u0628","\u0647\u0644 \u064A\u0645\u0643\u0646 \u0627\u0644\u062A\u0641\u0627\u0648\u0636 \u0639\u0644\u0649 \u0627\u0644\u0633\u0639\u0631\u061F","\u0645\u0648\u0639\u062F \u0627\u0644\u063A\u062F \u0645\u0646\u0627\u0633\u0628 \u062C\u062F\u0627\u064B"],confirmation:["\u062A\u0645\u0627\u0645\u060C \u0641\u064A \u0627\u0646\u062A\u0638\u0627\u0631\u0643","\u0634\u0643\u0631\u0627\u064B \u0644\u0643\u060C \u0627\u0644\u0645\u0648\u0639\u062F \u0645\u0624\u0643\u062F","\u0623\u062A\u0645\u0646\u0649 \u0623\u0646 \u062A\u0643\u0648\u0646 \u062F\u0642\u064A\u0642 \u0641\u064A \u0627\u0644\u0645\u0648\u0639\u062F"],completion:["\u0634\u0643\u0631\u0627\u064B \u062C\u0632\u064A\u0644\u0627\u064B \u0639\u0644\u0649 \u0627\u0644\u0639\u0645\u0644 \u0627\u0644\u0645\u0645\u062A\u0627\u0632","\u0627\u0644\u062E\u062F\u0645\u0629 \u0643\u0627\u0646\u062A \u0645\u0645\u062A\u0627\u0632\u0629","\u0633\u0623\u0642\u0648\u0645 \u0628\u0627\u0644\u062A\u0642\u064A\u064A\u0645 \u062D\u0627\u0644\u0627\u064B"],negotiation:["\u062D\u0633\u0646\u0627\u064B\u060C \u0623\u0648\u0627\u0641\u0642 \u0639\u0644\u0649 \u0627\u0644\u0633\u0639\u0631 \u0627\u0644\u0645\u0642\u062A\u0631\u062D","\u0647\u0644 \u064A\u0645\u0643\u0646 \u0627\u0644\u062F\u0641\u0639 \u0639\u0646\u062F \u0627\u0643\u062A\u0645\u0627\u0644 \u0627\u0644\u0639\u0645\u0644\u061F","\u0623\u0642\u0628\u0644 \u0627\u0644\u0639\u0631\u0636 \u0645\u0639 \u0627\u0644\u062E\u0635\u0645"]};return e[t][Math.floor(Math.random()*e[t].length)]}getRandomFutureDate(){let t=new Date;return t.setDate(t.getDate()+Math.floor(Math.random()*7)+1),t.toLocaleDateString("ar-EG",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}getThreads(t){return this.threads.pipe(A(e=>{let n=[...e];return t==="unread"?n=n.filter(i=>i.unreadCount>0):t==="active"?n=n.filter(i=>i.status==="active"):t==="archived"&&(n=n.filter(i=>i.status==="archived")),n.sort((i,o)=>o.lastActivity.getTime()-i.lastActivity.getTime())}))}getThread(t){return this.threads.pipe(A(e=>e.find(n=>n.id===t)))}markAsRead(t){let e=this.threads.value,n=e.findIndex(o=>o.id===t);if(n===-1)return w(!1);let i=[...e];return i[n]=C(v({},i[n]),{unreadCount:0,lastMessage:C(v({},i[n].lastMessage),{read:!0})}),this.threads.next(i),w(!0).pipe(O(300))}searchThreads(t){let e=t.toLowerCase().trim();return this.threads.pipe(A(n=>n.filter(i=>i.worker.name.toLowerCase().includes(e)||i.worker.service.toLowerCase().includes(e)||i.lastMessage.content.toLowerCase().includes(e)||i.serviceRequest?.service.toLowerCase().includes(e))))}getUnreadCount(){return this.threads.pipe(A(t=>t.reduce((e,n)=>e+n.unreadCount,0)))}archiveThread(t){let e=this.threads.value,n=e.findIndex(o=>o.id===t);if(n===-1)return w(!1);let i=[...e];return i[n]=C(v({},i[n]),{status:"archived"}),this.threads.next(i),w(!0).pipe(O(300))}blockThread(t){let e=this.threads.value,n=e.findIndex(o=>o.id===t);if(n===-1)return w(!1);let i=[...e];return i[n]=C(v({},i[n]),{status:"blocked"}),this.threads.next(i),w(!0).pipe(O(300))}deleteThread(t){let n=this.threads.value.filter(i=>i.id!==t);return this.threads.next(n),w(!0).pipe(O(300))}markAllAsRead(){let e=this.threads.value.map(n=>C(v({},n),{unreadCount:0,lastMessage:C(v({},n.lastMessage),{read:!0})}));return this.threads.next(e),w(!0).pipe(O(300))}sendAttachment(t,e,n){let i={id:Date.now(),senderId:1,receiverId:t,content:n,timestamp:new Date,read:!1,type:e},o=this.threads.value,u=o.findIndex(h=>h.id===t);if(u!==-1){let h=[...o];h[u]=C(v({},h[u]),{lastMessage:i,lastActivity:new Date}),this.threads.next(h),setTimeout(()=>{this.simulateWorkerResponse(t,h[u])},Math.random()*3e3+2e3)}return w(i).pipe(O(300))}persistThreads(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.threads.value))}catch(t){console.error("Error persisting threads:",t)}}restoreThreads(){try{let t=localStorage.getItem(this.STORAGE_KEY);if(t)return JSON.parse(t).map(n=>C(v({},n),{lastActivity:new Date(n.lastActivity),lastMessage:C(v({},n.lastMessage),{timestamp:new Date(n.lastMessage.timestamp)})}))}catch(t){console.error("Error restoring threads:",t)}return[]}destroy(){this.threads.complete(),this.typingStatus.complete()}static{this.\u0275fac=function(e){return new(e||a)(Qt(re))}}static{this.\u0275prov=$t({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var Ke=["messageContainer"],Je=["messageInput"];function tn(a,l){a&1&&b(0,"div",39)}function en(a,l){if(a&1&&(s(0,"span",37),m(1),c()),a&2){let t=f(2);r(),P(" (",t.thread.worker.completedJobs," \u062E\u062F\u0645\u0629) ")}}function nn(a,l){if(a&1&&(s(0,"div",28)(1,"div",29),b(2,"img",30),g(3,tn,1,0,"div",31),c(),s(4,"div",32)(5,"h2"),m(6),c(),s(7,"div",33)(8,"span",34),b(9,"i",35),m(10),c(),s(11,"span",36),m(12,"\u2022"),c(),s(13,"span",37),m(14),c(),g(15,en,2,1,"span",38),c()()()),a&2){let t=f();r(2),d("src",t.thread.worker.image,K)("alt",t.thread.worker.name),r(),d("ngIf",t.thread.status==="active"),r(3),T(t.thread.worker.name),r(4),P(" ",t.thread.worker.rating," "),r(4),T(t.thread.worker.service),r(),d("ngIf",t.thread.worker.completedJobs)}}function an(a,l){if(a&1&&(s(0,"div",40)(1,"div",41)(2,"span",42),m(3),c(),s(4,"span",43),m(5),c()()()),a&2){let t=f();r(3),T(t.thread==null||t.thread.serviceRequest==null?null:t.thread.serviceRequest.service),r(),S((t.thread==null||t.thread.serviceRequest==null?null:t.thread.serviceRequest.status)||""),r(),P(" ",(t.thread==null||t.thread.serviceRequest==null?null:t.thread.serviceRequest.status)==="pending"?"\u0642\u064A\u062F \u0627\u0644\u0627\u0646\u062A\u0638\u0627\u0631":(t.thread==null||t.thread.serviceRequest==null?null:t.thread.serviceRequest.status)==="in_progress"?"\u062C\u0627\u0631\u064A \u0627\u0644\u062A\u0646\u0641\u064A\u0630":"\u0645\u0643\u062A\u0645\u0644"," ")}}function on(a,l){a&1&&(s(0,"div",44),b(1,"div",45),c())}function rn(a,l){if(a&1){let t=R();s(0,"div",46),b(1,"i",47),s(2,"p"),m(3),c(),s(4,"button",48),k("click",function(){_(t);let n=f();return x(n.loadThread(n.thread==null?null:n.thread.id))}),b(5,"i",49),m(6," \u0625\u0639\u0627\u062F\u0629 \u0627\u0644\u0645\u062D\u0627\u0648\u0644\u0629 "),c()()}if(a&2){let t=f();r(3),T(t.error)}}function sn(a,l){a&1&&(s(0,"div",53),b(1,"i",54),s(2,"p",55),m(3,"\u0644\u0627 \u062A\u0648\u062C\u062F \u0631\u0633\u0627\u0626\u0644"),c(),s(4,"p",56),m(5,"\u0627\u0628\u062F\u0623 \u0645\u062D\u0627\u062F\u062B\u0629 \u062C\u062F\u064A\u062F\u0629 \u0627\u0644\u0622\u0646"),c()())}function cn(a,l){if(a&1&&(B(0),m(1),N()),a&2){let t=f().$implicit;r(),P(" ",t.content," ")}}function dn(a,l){if(a&1&&(B(0),b(1,"img",64),N()),a&2){let t=f().$implicit;r(),d("src",t.content,K)}}function mn(a,l){a&1&&(B(0),s(1,"div",65),b(2,"i",66),s(3,"span"),m(4,"\u062A\u0645 \u0645\u0634\u0627\u0631\u0643\u0629 \u0627\u0644\u0645\u0648\u0642\u0639"),c()(),N())}function ln(a,l){if(a&1&&(s(0,"div",70)(1,"div",71)(2,"span",72),m(3),c(),s(4,"span",73),m(5),c()()()),a&2){let t=f(5);r(3),T(t.thread==null||t.thread.serviceRequest==null?null:t.thread.serviceRequest.service),r(),S((t.thread==null||t.thread.serviceRequest==null?null:t.thread.serviceRequest.status)||""),r(),P(" ",(t.thread==null||t.thread.serviceRequest==null?null:t.thread.serviceRequest.status)==="pending"?"\u0642\u064A\u062F \u0627\u0644\u0627\u0646\u062A\u0638\u0627\u0631":(t.thread==null||t.thread.serviceRequest==null?null:t.thread.serviceRequest.status)==="in_progress"?"\u062C\u0627\u0631\u064A \u0627\u0644\u062A\u0646\u0641\u064A\u0630":"\u0645\u0643\u062A\u0645\u0644"," ")}}function un(a,l){if(a&1&&(B(0),s(1,"div",67),b(2,"i",68),s(3,"span"),m(4,"\u0637\u0644\u0628 \u062E\u062F\u0645\u0629 \u062C\u062F\u064A\u062F"),c(),g(5,ln,6,4,"div",69),c(),N()),a&2){let t=f().$implicit;r(5),d("ngIf",t.serviceRequestId)}}function bn(a,l){if(a&1&&(B(0),b(1,"i",74),N()),a&2){let t=f().$implicit;r(),D("fa-check",!t.read)("fa-check-double",t.read)("read",t.read)}}function pn(a,l){if(a&1&&(s(0,"div",60)(1,"div",61),g(2,cn,2,1,"ng-container",62)(3,dn,2,1,"ng-container",62)(4,mn,5,0,"ng-container",62)(5,un,6,1,"ng-container",62),c(),s(6,"div",63),m(7),g(8,bn,2,6,"ng-container",19),c()()),a&2){let t=l.$implicit,e=l.index,n=f().$implicit,i=f(2);D("sent",t.senderId===i.currentUserId)("received",t.senderId!==i.currentUserId)("consecutive",i.isConsecutiveMessage(t,n.messages[e-1])),r(),d("ngSwitch",t.type),r(),d("ngSwitchCase","text"),r(),d("ngSwitchCase","image"),r(),d("ngSwitchCase","location"),r(),d("ngSwitchCase","service_request"),r(2),P(" ",i.formatMessageTime(t.timestamp)," "),r(),d("ngIf",t.senderId===i.currentUserId)}}function fn(a,l){if(a&1&&(s(0,"div",57)(1,"div",58)(2,"span"),m(3),c()(),g(4,pn,9,13,"div",59),c()),a&2){let t=l.$implicit;r(3),T(t.date),r(),d("ngForOf",t.messages)}}function gn(a,l){a&1&&(s(0,"div",75)(1,"div",76),b(2,"span")(3,"span")(4,"span"),c(),s(5,"span",77),m(6,"\u064A\u0643\u062A\u0628..."),c()())}function hn(a,l){if(a&1&&(B(0),g(1,sn,6,0,"div",50)(2,fn,5,2,"div",51)(3,gn,7,0,"div",52),N()),a&2){let t=f();r(),d("ngIf",t.messages.length===0),r(),d("ngForOf",t.messageGroups),r(),d("ngIf",t.showTypingIndicator)}}function vn(a,l){a&1&&(s(0,"div",78),b(1,"i",13),s(2,"span"),m(3,"\u062A\u0645 \u062D\u0638\u0631 \u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0629"),c()())}var Te=(()=>{class a{constructor(t,e,n,i){this.messageService=t,this.route=e,this.router=n,this.viewportScroller=i,this.destroy$=new E,this.shouldScrollToBottom=!1,this.messages=[],this.newMessage="",this.currentUserId=1,this.loading=!0,this.error=null,this.isTyping=!1,this.workerIsTyping=!1}ngOnInit(){window.scrollTo(0,0),this.viewportScroller.scrollToPosition([0,0]),this.route.params.pipe(M(this.destroy$),A(t=>+t.id)).subscribe({next:t=>{this.loading=!0,this.error=null,this.messages=[],this.workerIsTyping=!1,this.clearTypingTimers(),this.loadThread(t),this.messageService.getTypingStatus$().pipe(M(this.destroy$),A(e=>e.some(n=>n.threadId===t&&n.isTyping&&n.userId!==this.currentUserId))).subscribe({next:e=>{this.workerIsTyping=e,e&&this.simulateWorkerTyping()},error:e=>{console.error("Error in typing status subscription:",e)}})},error:t=>{console.error("Error in route params subscription:",t),this.error="\u062D\u062F\u062B \u062E\u0637\u0623 \u0641\u064A \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0629",this.loading=!1}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.clearTypingTimers()}ngAfterViewChecked(){this.shouldScrollToBottom&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}clearTypingTimers(){this.typingTimeout&&clearTimeout(this.typingTimeout),this.workerTypingTimer&&clearTimeout(this.workerTypingTimer)}loadThread(t){this.loading=!0,this.error=null,this.messageService.getThread(t).pipe(M(this.destroy$)).subscribe({next:e=>{if(!e){this.error="\u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0629 \u063A\u064A\u0631 \u0645\u0648\u062C\u0648\u062F\u0629",this.loading=!1;return}this.thread=e,this.loadMessages(t)},error:e=>{console.error("Error loading thread:",e),this.error="\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0629",this.loading=!1}})}loadMessages(t){this.messageService.getMessageHistory(t).pipe(M(this.destroy$)).subscribe({next:e=>{this.messages=e,this.loading=!1,this.shouldScrollToBottom=!0},error:e=>{console.error("Error loading messages:",e),this.error="\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0631\u0633\u0627\u0626\u0644",this.loading=!1}})}sendMessage(){if(!this.thread||!this.newMessage.trim())return;this.isTyping=!1,this.clearTypingTimers();let t={id:Date.now(),senderId:this.currentUserId,receiverId:this.thread.workerId,content:this.newMessage.trim(),timestamp:new Date,read:!1,type:"text"};this.messages=[...this.messages,t],this.shouldScrollToBottom=!0;let e=this.newMessage;this.newMessage="",this.messageInput.nativeElement.focus(),this.messageService.sendMessage(this.thread.id,e).pipe(M(this.destroy$)).subscribe({next:n=>{this.messages=this.messages.map(i=>i.id===t.id?n:i),setTimeout(()=>{this.workerIsTyping=!0,this.simulateWorkerTyping()},1e3)},error:n=>{console.error("Error sending message:",n),this.messages=this.messages.filter(i=>i.id!==t.id),this.error="\u0641\u0634\u0644 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0631\u0633\u0627\u0644\u0629"}})}onInputChange(){this.typingTimeout&&clearTimeout(this.typingTimeout),this.isTyping=!0,this.thread&&this.messageService.sendTypingStatus&&this.messageService.sendTypingStatus(this.thread.id,!0),this.typingTimeout=setTimeout(()=>{this.isTyping=!1,this.thread&&this.messageService.sendTypingStatus&&this.messageService.sendTypingStatus(this.thread.id,!1)},3e3)}simulateWorkerTyping(){if(this.workerIsTyping&&!this.workerTypingTimer){let t=Math.random()*2e3+2e3;this.workerTypingTimer=setTimeout(()=>{this.workerIsTyping=!1,this.workerTypingTimer=void 0},t)}}get messagesContainerClass(){return this.thread?.serviceRequest?"chat-messages has-service-banner":"chat-messages"}scrollToBottom(){try{let t=this.messageContainer.nativeElement;t.scrollTop=t.scrollHeight}catch(t){console.error("Error scrolling to bottom:",t)}}get messageGroups(){let t=[],e="";return this.messages.forEach(n=>{let i=new Date(n.timestamp).toLocaleDateString("ar-EG",{weekday:"long",year:"numeric",month:"long",day:"numeric"});i!==e&&(e=i,t.push({date:i,messages:[]})),t[t.length-1].messages.push(n)}),t}get showTypingIndicator(){return this.workerIsTyping&&!this.thread?.serviceRequest}formatMessageTime(t){return new Date(t).toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit",hour12:!0})}isConsecutiveMessage(t,e){if(!e)return!1;let n=new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime();return t.senderId===e.senderId&&n<6e4}goBack(){this.router.navigate(["/messages"])}openAttachmentMenu(){console.log("Opening attachment menu")}blockThread(){this.thread&&confirm("\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0638\u0631 \u0647\u0630\u0647 \u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0629\u061F")&&this.messageService.blockThread(this.thread.id).pipe(M(this.destroy$)).subscribe({next:()=>{this.router.navigate(["/messages"])},error:t=>{console.error("Error blocking thread:",t),this.error="\u0641\u0634\u0644 \u062D\u0638\u0631 \u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0629"}})}deleteThread(){this.thread&&confirm("\u0647\u0644 \u0623\u0646\u062A \u0645\u062A\u0623\u0643\u062F \u0645\u0646 \u062D\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0629\u061F")&&this.messageService.deleteThread(this.thread.id).pipe(M(this.destroy$)).subscribe({next:()=>{this.router.navigate(["/messages"])},error:t=>{console.error("Error deleting thread:",t),this.error="\u0641\u0634\u0644 \u062D\u0630\u0641 \u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0629"}})}static{this.\u0275fac=function(e){return new(e||a)(p(Et),p(ae),p(Ct),p(ie))}}static{this.\u0275cmp=F({type:a,selectors:[["app-message-detail"]],viewQuery:function(e,n){if(e&1&&(tt(Ke,5),tt(Je,5)),e&2){let i;z(i=j())&&(n.messageContainer=i.first),z(i=j())&&(n.messageInput=i.first)}},decls:34,vars:16,consts:[["menu","matMenu"],["messageContainer",""],["messageInput",""],["dir","rtl",1,"chat-container"],[1,"chat-header"],[1,"header-actions"],[1,"back-button",3,"click"],[1,"fas","fa-arrow-right"],["class","worker-info",4,"ngIf"],[1,"action-button",3,"matMenuTriggerFor"],[1,"fas","fa-ellipsis-v"],[1,"message-options-menu"],["mat-menu-item","",1,"block-button",3,"click"],[1,"fas","fa-ban"],["mat-menu-item","",1,"delete-button",3,"click"],[1,"fas","fa-trash"],["class","service-request-banner",4,"ngIf"],["class","loading-spinner",4,"ngIf"],["class","error-state",4,"ngIf"],[4,"ngIf"],[1,"chat-input"],[1,"input-container"],[1,"attachment-button",3,"click","disabled"],[1,"fas","fa-paperclip"],["type","text",3,"ngModelChange","keyup.enter","input","ngModel","placeholder","disabled"],[1,"send-button",3,"click","disabled"],[1,"fas","fa-paper-plane"],["class","blocked-banner",4,"ngIf"],[1,"worker-info"],[1,"avatar-container"],[1,"avatar",3,"src","alt"],["class","online-indicator",4,"ngIf"],[1,"worker-details"],[1,"worker-meta"],[1,"rating"],[1,"fas","fa-star"],[1,"separator"],[1,"service"],["class","service",4,"ngIf"],[1,"online-indicator"],[1,"service-request-banner"],[1,"request-info"],[1,"service-type"],[1,"status-badge"],[1,"loading-spinner"],[1,"spinner"],[1,"error-state"],[1,"fas","fa-exclamation-circle"],[1,"retry-button",3,"click"],[1,"fas","fa-redo"],["class","empty-state",4,"ngIf"],["class","messages-date-group",4,"ngFor","ngForOf"],["class","typing-indicator",4,"ngIf"],[1,"empty-state"],[1,"fas","fa-comments"],[1,"empty-text"],[1,"empty-subtext"],[1,"messages-date-group"],[1,"date-divider"],["class","message-bubble",3,"sent","received","consecutive",4,"ngFor","ngForOf"],[1,"message-bubble"],[1,"message-content",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"message-time"],["alt","\u0635\u0648\u0631\u0629 \u0645\u0631\u0633\u0644\u0629","loading","lazy",1,"message-image",3,"src"],[1,"location-preview"],[1,"fas","fa-map-marker-alt"],[1,"service-request-card"],[1,"fas","fa-tools"],["class","request-details",4,"ngIf"],[1,"request-details"],[1,"service-info"],[1,"service-name"],[1,"service-status"],[1,"fas"],[1,"typing-indicator"],[1,"typing-bubble"],[1,"typing-text"],[1,"blocked-banner"]],template:function(e,n){if(e&1){let i=R();s(0,"div",3)(1,"header",4)(2,"div",5)(3,"button",6),k("click",function(){return _(i),x(n.goBack())}),b(4,"i",7),c()(),g(5,nn,16,7,"div",8),s(6,"div",5)(7,"button",9),b(8,"i",10),c(),s(9,"mat-menu",11,0)(11,"button",12),k("click",function(){return _(i),x(n.blockThread())}),b(12,"i",13),s(13,"span"),m(14,"\u062D\u0638\u0631 \u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0629"),c()(),s(15,"button",14),k("click",function(){return _(i),x(n.deleteThread())}),b(16,"i",15),s(17,"span"),m(18,"\u062D\u0630\u0641 \u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0629"),c()()()()(),g(19,an,6,4,"div",16),s(20,"main",null,1),g(22,on,2,0,"div",17)(23,rn,7,1,"div",18)(24,hn,4,3,"ng-container",19),c(),s(25,"footer",20)(26,"div",21)(27,"button",22),k("click",function(){return _(i),x(n.openAttachmentMenu())}),b(28,"i",23),c(),s(29,"input",24,2),vt("ngModelChange",function(u){return _(i),ht(n.newMessage,u)||(n.newMessage=u),x(u)}),k("keyup.enter",function(){return _(i),x(n.sendMessage())})("input",function(){return _(i),x(n.onInputChange())}),c(),s(31,"button",25),k("click",function(){return _(i),x(n.sendMessage())}),b(32,"i",26),c()(),g(33,vn,4,0,"div",27),c()()}if(e&2){let i=Kt(10);r(5),d("ngIf",n.thread),r(2),d("matMenuTriggerFor",i),r(12),d("ngIf",n.thread==null?null:n.thread.serviceRequest),r(),S(n.messagesContainerClass),r(2),d("ngIf",n.loading),r(),d("ngIf",n.error),r(),d("ngIf",!n.loading&&!n.error),r(),D("blocked",(n.thread==null?null:n.thread.status)==="blocked"),r(2),d("disabled",(n.thread==null?null:n.thread.status)==="blocked"),r(2),gt("ngModel",n.newMessage),d("placeholder",(n.thread==null?null:n.thread.status)==="blocked"?"\u062A\u0645 \u062D\u0638\u0631 \u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0629":"\u0627\u0643\u062A\u0628 \u0631\u0633\u0627\u0644\u062A\u0643 \u0647\u0646\u0627...")("disabled",(n.thread==null?null:n.thread.status)==="blocked"),r(2),d("disabled",!n.newMessage.trim()||(n.thread==null?null:n.thread.status)==="blocked"),r(2),d("ngIf",(n.thread==null?null:n.thread.status)==="blocked")}},dependencies:[xt,yt,ee,ne,Pt,It,Ot,U,Tt,at,ke],styles:['.chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:calc(100vh - 56px);position:fixed;inset:0 0 56px;background-color:#fff;z-index:1}.chat-header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;z-index:10;background-color:#ef4444;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;color:#fff;box-shadow:0 2px 4px #0000001a;height:56px}.chat-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;color:#fff;padding:8px;cursor:pointer;transition:all .2s;width:36px;height:36px;display:flex;align-items:center;justify-content:center}.chat-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#ffffff1a;border-radius:50%}.chat-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem}.chat-header[_ngcontent-%COMP%]   .worker-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.chat-header[_ngcontent-%COMP%]   .worker-info[_ngcontent-%COMP%]   .avatar-container[_ngcontent-%COMP%]{position:relative}.chat-header[_ngcontent-%COMP%]   .worker-info[_ngcontent-%COMP%]   .avatar-container[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;border:2px solid white;object-fit:cover}.chat-header[_ngcontent-%COMP%]   .worker-info[_ngcontent-%COMP%]   .avatar-container[_ngcontent-%COMP%]   .online-indicator[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;width:10px;height:10px;background:#10b981;border:2px solid white;border-radius:50%}.chat-header[_ngcontent-%COMP%]   .worker-info[_ngcontent-%COMP%]   .worker-details[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:14px;font-weight:600}.chat-header[_ngcontent-%COMP%]   .worker-info[_ngcontent-%COMP%]   .worker-details[_ngcontent-%COMP%]   .worker-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:2px;font-size:12px;opacity:.9}.chat-header[_ngcontent-%COMP%]   .worker-info[_ngcontent-%COMP%]   .worker-details[_ngcontent-%COMP%]   .worker-meta[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.chat-header[_ngcontent-%COMP%]   .worker-info[_ngcontent-%COMP%]   .worker-details[_ngcontent-%COMP%]   .worker-meta[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fbbf24}.chat-messages[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:16px;background:#fff;margin-top:56px;margin-bottom:60px;height:calc(100vh - 172px)}.chat-messages.has-service-banner[_ngcontent-%COMP%]{margin-top:108px;height:calc(100vh - 224px)}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#e5e7eb;border-radius:3px}.chat-messages[_ngcontent-%COMP%]   .messages-date-group[_ngcontent-%COMP%]{margin-bottom:24px}.chat-messages[_ngcontent-%COMP%]   .messages-date-group[_ngcontent-%COMP%]   .date-divider[_ngcontent-%COMP%]{text-align:center;margin:16px 0;position:relative;color:#6b7280;font-size:12px}.chat-messages[_ngcontent-%COMP%]   .messages-date-group[_ngcontent-%COMP%]   .date-divider[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:50%;width:100%;height:1px;background:#e5e7eb;z-index:0}.chat-messages[_ngcontent-%COMP%]   .messages-date-group[_ngcontent-%COMP%]   .date-divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 16px;position:relative;z-index:1}.chat-messages[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{max-width:70%;margin-bottom:8px;display:flex;flex-direction:column}.chat-messages[_ngcontent-%COMP%]   .message-bubble.sent[_ngcontent-%COMP%]{margin-left:auto}.chat-messages[_ngcontent-%COMP%]   .message-bubble.sent[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff;border-radius:16px 16px 4px;margin-left:auto}.chat-messages[_ngcontent-%COMP%]   .message-bubble.sent[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{margin-left:auto;margin-right:4px;color:#fffc}.chat-messages[_ngcontent-%COMP%]   .message-bubble.received[_ngcontent-%COMP%]{margin-right:auto}.chat-messages[_ngcontent-%COMP%]   .message-bubble.received[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background-color:#f3f4f6;color:#1f2937;border-radius:16px 16px 16px 4px}.chat-messages[_ngcontent-%COMP%]   .message-bubble.received[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{margin-right:auto;margin-left:4px;color:#6b7280}.chat-messages[_ngcontent-%COMP%]   .message-bubble.consecutive[_ngcontent-%COMP%]{margin-top:-4px}.chat-messages[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{padding:12px 16px;font-size:14px;line-height:1.5;margin-bottom:4px}.chat-messages[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{font-size:11px;display:flex;align-items:center;gap:4px}.chat-messages[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px}.chat-messages[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]   i.read[_ngcontent-%COMP%]{color:#10b981}.service-request-banner[_ngcontent-%COMP%]{position:absolute;top:80px;left:0;right:0;z-index:9;background:#f9fafb;padding:12px 16px;border-bottom:1px solid #e5e7eb}.service-request-banner[_ngcontent-%COMP%]   .request-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;font-size:.875rem}.service-request-banner[_ngcontent-%COMP%]   .request-info[_ngcontent-%COMP%]   .service-type[_ngcontent-%COMP%]{color:#1f2937;font-weight:500}.service-request-banner[_ngcontent-%COMP%]   .request-info[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:999px;font-size:.75rem;font-weight:500}.service-request-banner[_ngcontent-%COMP%]   .request-info[_ngcontent-%COMP%]   .status-badge.pending[_ngcontent-%COMP%]{background:#fff7ed;color:#c2410c}.service-request-banner[_ngcontent-%COMP%]   .request-info[_ngcontent-%COMP%]   .status-badge.in_progress[_ngcontent-%COMP%]{background:#eff6ff;color:#1d4ed8}.service-request-banner[_ngcontent-%COMP%]   .request-info[_ngcontent-%COMP%]   .status-badge.completed[_ngcontent-%COMP%]{background:#f0fdf4;color:#15803d}.chat-input[_ngcontent-%COMP%]{position:fixed;bottom:56px;left:0;right:0;padding:8px 16px;background:#fff;border-top:1px solid #eee;z-index:10;height:60px}.chat-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{height:44px;display:flex;align-items:center;gap:8px;background:#f3f4f6;border-radius:24px;padding:4px 6px}.chat-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .attachment-button[_ngcontent-%COMP%]{background:none;border:none;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#9ca3af;transition:all .2s ease}.chat-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .attachment-button[_ngcontent-%COMP%]:hover{background:#0000000d;color:#6b7280}.chat-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .attachment-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem}.chat-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;background:transparent;padding:6px 12px;font-size:.9375rem;color:#1f2937;height:36px;min-height:36px;direction:rtl}.chat-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.chat-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none}.chat-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%]{background:#ef4444;border:none;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;transition:all .2s ease}.chat-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%]:hover:not(:disabled){background:#dc2626;transform:scale(1.05)}.chat-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%]:disabled{background:#f3f4f6;color:#d1d5db}.chat-input[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}.loading-spinner[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid #f3f4f6;border-top-color:#ef4444;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 24px;text-align:center;height:100%;background:#fff}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:48px;color:#d1d5db;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   .empty-text[_ngcontent-%COMP%]{color:#6b7280;font-size:1rem;margin-bottom:8px}.error-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 24px;text-align:center;height:100%;background:#fff}.error-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:48px;color:#ef4444;margin-bottom:16px}.error-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6b7280;font-size:1rem;margin-bottom:16px}.error-state[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]{padding:8px 16px;background:#ef4444;color:#fff;border:none;border-radius:8px;font-size:.875rem;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s ease}.error-state[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]:hover{background:#dc2626}.error-state[_ngcontent-%COMP%]   .retry-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem;color:#fff;margin:0}.mat-menu-panel.message-options-menu[_ngcontent-%COMP%]{min-width:180px!important;border-radius:12px!important;margin-top:8px!important}.mat-menu-panel.message-options-menu[_ngcontent-%COMP%]   .mat-menu-content[_ngcontent-%COMP%]{padding:8px!important}.mat-menu-panel.message-options-menu[_ngcontent-%COMP%]   .mat-menu-item[_ngcontent-%COMP%]{border-radius:8px;height:44px;line-height:44px;font-size:.9375rem;color:#1f2937}.mat-menu-panel.message-options-menu[_ngcontent-%COMP%]   .mat-menu-item[_ngcontent-%COMP%]:hover{background:#f3f4f6}.mat-menu-panel.message-options-menu[_ngcontent-%COMP%]   .mat-menu-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:12px;color:#6b7280}.typing-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 16px}.typing-indicator[_ngcontent-%COMP%]   .typing-bubble[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.typing-indicator[_ngcontent-%COMP%]   .typing-bubble[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:8px;height:8px;background:#d1d5db;border-radius:50%;animation:_ngcontent-%COMP%_bounce 1.4s infinite ease-in-out}.typing-indicator[_ngcontent-%COMP%]   .typing-bubble[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){animation-delay:-.32s}.typing-indicator[_ngcontent-%COMP%]   .typing-bubble[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){animation-delay:-.16s}.typing-indicator[_ngcontent-%COMP%]   .typing-text[_ngcontent-%COMP%]{font-size:12px;color:#6b7280}.blocked-banner[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:8px;background:#fee2e2;color:#ef4444;font-size:.875rem}.blocked-banner[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_bounce{0%,80%,to{transform:scale(0)}40%{transform:scale(1)}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}']})}}return a})();function _n(a,l){if(a&1&&(s(0,"div",16),m(1),c()),a&2){let t=f();r(),P(" ",t.getTotalUnreadCount()," ")}}function xn(a,l){if(a&1){let t=R();s(0,"button",17),k("click",function(){let n=_(t).$implicit,i=f();return x(i.setActiveFilter(n.id))}),m(1),c()}if(a&2){let t=l.$implicit;D("pill-active",t.active)("pill-inactive",!t.active),r(),P(" ",t.label," ")}}function yn(a,l){if(a&1&&(s(0,"div",38),m(1),c()),a&2){let t=f().$implicit;r(),P(" ",t.unreadCount," ")}}function Mn(a,l){a&1&&b(0,"div",39)}function Cn(a,l){if(a&1&&(s(0,"span",40),m(1),c()),a&2){let t=f().$implicit;r(),P(" (",t.worker.completedJobs," \u062E\u062F\u0645\u0629) ")}}function wn(a,l){if(a&1&&(s(0,"div",41)(1,"span",42),m(2),c(),s(3,"span",43),m(4),c()()),a&2){let t=f().$implicit;r(2),T(t.serviceRequest.service),r(),S(t.serviceRequest.status),r(),P(" ",t.serviceRequest.status==="pending"?"\u0642\u064A\u062F \u0627\u0644\u0627\u0646\u062A\u0638\u0627\u0631":t.serviceRequest.status==="in_progress"?"\u062C\u0627\u0631\u064A \u0627\u0644\u062A\u0646\u0641\u064A\u0630":"\u0645\u0643\u062A\u0645\u0644"," ")}}function kn(a,l){if(a&1){let t=R();s(0,"div",18),k("click",function(){let n=_(t).$implicit,i=f();return x(i.openThread(n))}),s(1,"div",19)(2,"div",20)(3,"span",21),m(4),c(),g(5,yn,2,1,"div",22),c(),s(6,"div",23)(7,"div",24)(8,"div",25),b(9,"img",26),g(10,Mn,1,0,"div",27),c(),s(11,"div",28)(12,"h3",29),m(13),c(),s(14,"div",30)(15,"span",31),b(16,"i",32),m(17),c(),s(18,"span",33),m(19,"\u2022"),c(),s(20,"span",34),m(21),c(),g(22,Cn,2,1,"span",35),c()()()(),s(23,"p",36),m(24),c(),g(25,wn,5,4,"div",37),c()()}if(a&2){let t=l.$implicit,e=f();D("unread",t.unreadCount>0),r(4),T(e.formatTimestamp(t.lastActivity)),r(),d("ngIf",t.unreadCount>0),r(4),d("src",t.worker.image,K)("alt",t.worker.name),r(),d("ngIf",t.status==="active"),r(3),T(t.worker.name),r(4),P(" ",t.worker.rating," "),r(4),T(t.worker.service),r(),d("ngIf",t.worker.completedJobs),r(),D("unread-message",t.unreadCount>0),r(),P(" ",t.lastMessage.content," "),r(),d("ngIf",t.serviceRequest)}}function Pn(a,l){a&1&&(s(0,"div",44)(1,"div",45),b(2,"i",46),c(),s(3,"h3",47),m(4,"\u0644\u0627 \u062A\u0648\u062C\u062F \u0645\u062D\u0627\u062F\u062B\u0627\u062A"),c(),s(5,"p",48),m(6,"\u0639\u0646\u062F \u0628\u062F\u0621 \u0645\u062D\u0627\u062F\u062B\u0629 \u062C\u062F\u064A\u062F\u0629 \u0645\u0639 \u0623\u062D\u062F \u0645\u0642\u062F\u0645\u064A \u0627\u0644\u062E\u062F\u0645\u0627\u062A\u060C \u0633\u062A\u0638\u0647\u0631 \u0647\u0646\u0627"),c()())}function In(a,l){a&1&&(s(0,"div",49),b(1,"div",50),c())}var De=(()=>{class a{constructor(t,e){this.messageService=t,this.router=e,this.destroy$=new E,this.searchQuery="",this.threads=[],this.loading=!0,this.filters=[{id:"all",label:"\u0627\u0644\u0643\u0644",active:!0},{id:"unread",label:"\u063A\u064A\u0631 \u0645\u0642\u0631\u0648\u0621\u0629",active:!1},{id:"active",label:"\u0646\u0634\u0637",active:!1},{id:"archived",label:"\u0645\u0624\u0631\u0634\u0641",active:!1}]}ngOnInit(){this.loadThreads(),this.setupSearchSubscription()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get filteredThreads(){return this.searchQuery.trim()?this.threads.filter(t=>t.worker.name.toLowerCase().includes(this.searchQuery.toLowerCase())||t.worker.service.toLowerCase().includes(this.searchQuery.toLowerCase())||t.lastMessage.content.toLowerCase().includes(this.searchQuery.toLowerCase())):this.threads}loadThreads(){this.loading=!0;let t=this.filters.find(e=>e.active)?.id;this.messageService.getThreads(t).pipe(M(this.destroy$)).subscribe({next:e=>{this.threads=e,this.loading=!1},error:e=>{console.error("Error loading threads:",e),this.loading=!1}})}setupSearchSubscription(){this.messageService.searchThreads(this.searchQuery).pipe(Yt(300),Ut(),M(this.destroy$)).subscribe(t=>{this.threads=t})}setActiveFilter(t){this.filters=this.filters.map(e=>C(v({},e),{active:e.id===t})),this.loadThreads()}formatTimestamp(t){let e=new Date(t),i=new Date().getTime()-e.getTime(),o=Math.floor(i/(1e3*60*60*24));if(o===0){let u=Math.floor(i/36e5);return u===0?`\u0645\u0646\u0630 ${Math.floor(i/6e4)} \u062F\u0642\u064A\u0642\u0629`:`\u0645\u0646\u0630 ${u} \u0633\u0627\u0639\u0629`}return o===1?"\u0623\u0645\u0633":o<=7?`\u0645\u0646\u0630 ${o} \u0623\u064A\u0627\u0645`:e.toLocaleDateString("ar-EG")}openThread(t){this.messageService.markAsRead(t.id).pipe(M(this.destroy$)).subscribe(()=>{this.router.navigate(["/messages",t.id])})}archiveThread(t,e){e.stopPropagation(),this.messageService.archiveThread(t).pipe(M(this.destroy$)).subscribe(()=>{this.loadThreads()})}getTotalUnreadCount(){return this.threads.reduce((t,e)=>t+e.unreadCount,0)}trackByThreadId(t,e){return e.id}static{this.\u0275fac=function(e){return new(e||a)(p(Et),p(Ct))}}static{this.\u0275cmp=F({type:a,selectors:[["app-messages"]],decls:18,vars:7,consts:[["dir","rtl",1,"messages-container"],[1,"header"],[1,"header-content"],[1,"header-title"],[1,"fas","fa-comment"],["class","unread-badge",4,"ngIf"],[1,"search-bar"],[1,"search-input-container"],["type","text","placeholder","\u0627\u0628\u062D\u062B \u0641\u064A \u0627\u0644\u0645\u062D\u0627\u062F\u062B\u0627\u062A...",1,"search-input",3,"ngModelChange","ngModel"],[1,"fas","fa-search"],[1,"filter-pills"],[3,"pill-active","pill-inactive","click",4,"ngFor","ngForOf"],[1,"messages-list"],["class","message-card",3,"unread","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","empty-state",4,"ngIf"],["class","loading-state",4,"ngIf"],[1,"unread-badge"],[3,"click"],[1,"message-card",3,"click"],[1,"message-content"],[1,"message-meta"],[1,"time"],["class","unread-count",4,"ngIf"],[1,"message-header"],[1,"user-info"],[1,"avatar-container"],[1,"avatar",3,"src","alt"],["class","online-indicator",4,"ngIf"],[1,"user-details"],[1,"user-name"],[1,"user-meta"],[1,"rating"],[1,"fas","fa-star"],[1,"separator"],[1,"service"],["class","job-count",4,"ngIf"],[1,"message-preview"],["class","service-request-info",4,"ngIf"],[1,"unread-count"],[1,"online-indicator"],[1,"job-count"],[1,"service-request-info"],[1,"service-type"],[1,"status-badge"],[1,"empty-state"],[1,"empty-icon"],[1,"fas","fa-comments"],[1,"empty-text"],[1,"empty-subtext"],[1,"loading-state"],[1,"spinner"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),b(4,"i",4),s(5,"h1"),m(6,"\u0627\u0644\u0631\u0633\u0627\u0626\u0644"),c(),g(7,_n,2,1,"div",5),c()(),s(8,"div",6)(9,"div",7)(10,"input",8),vt("ngModelChange",function(o){return ht(n.searchQuery,o)||(n.searchQuery=o),o}),c(),b(11,"i",9),c()(),s(12,"div",10),g(13,xn,2,5,"button",11),c()(),s(14,"div",12),g(15,kn,26,15,"div",13)(16,Pn,7,0,"div",14)(17,In,2,0,"div",15),c()()),e&2&&(r(7),d("ngIf",n.getTotalUnreadCount()>0),r(3),gt("ngModel",n.searchQuery),r(3),d("ngForOf",n.filters),r(2),d("ngForOf",n.filteredThreads)("ngForTrackBy",n.trackByThreadId),r(),d("ngIf",!n.loading&&n.filteredThreads.length===0),r(),d("ngIf",n.loading))},dependencies:[xt,yt,Pt,It,Ot,Tt],styles:['[_nghost-%COMP%]{display:block}.messages-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#f8f9fa}.header[_ngcontent-%COMP%]{background-color:#ef4444;padding:24px 16px 16px}.header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;position:relative}.header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff;font-size:20px}.header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#fff;font-size:20px;font-weight:700}.header[_ngcontent-%COMP%]   .unread-badge[_ngcontent-%COMP%]{position:absolute;left:-48px;display:flex;align-items:center;justify-content:center;background:#fff3;color:#fff;font-weight:700;padding:2px 8px;border-radius:999px;min-width:24px}.search-bar[_ngcontent-%COMP%]{margin-bottom:16px}.search-bar[_ngcontent-%COMP%]   .search-input-container[_ngcontent-%COMP%]{display:flex;align-items:center;background:#ffffff1a;border-radius:8px;overflow:hidden}.search-bar[_ngcontent-%COMP%]   .search-input-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{flex:1;background:transparent;border:none;padding:10px 16px;color:#fff;font-size:14px}.search-bar[_ngcontent-%COMP%]   .search-input-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]::placeholder{color:#ffffffb3}.search-bar[_ngcontent-%COMP%]   .search-input-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]:focus{outline:none}.search-bar[_ngcontent-%COMP%]   .search-input-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#ffffffb3;margin:0 16px}.filter-pills[_ngcontent-%COMP%]{display:flex;gap:8px;overflow-x:auto;padding:4px 0;-webkit-overflow-scrolling:touch;scrollbar-width:none;-ms-overflow-style:none}.filter-pills[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.filter-pills[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 24px;border-radius:50px;font-size:14px;font-weight:500;white-space:nowrap;transition:all .2s ease;border:1px solid rgba(255,255,255,.2);background:transparent;color:#fff}.filter-pills[_ngcontent-%COMP%]   button.pill-inactive[_ngcontent-%COMP%]{background:#fff3}.filter-pills[_ngcontent-%COMP%]   button.pill-inactive[_ngcontent-%COMP%]:hover{background:#ffffff4d}.filter-pills[_ngcontent-%COMP%]   button.pill-active[_ngcontent-%COMP%]{background:#fff;color:#ef4444;border-color:#fff}.filter-pills[_ngcontent-%COMP%]   button.pill-active[_ngcontent-%COMP%]:hover{background:#ffffffe6}.messages-list[_ngcontent-%COMP%]{padding:16px}.message-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;margin-bottom:12px;overflow:hidden;box-shadow:0 2px 4px #0000000d;position:relative;transition:all .2s ease}.message-card.unread[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;bottom:0;width:4px;background-color:#ef4444;border-radius:4px 0 0 4px}.message-card[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 8px #0000001a}.message-card[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{padding:16px}.message-card[_ngcontent-%COMP%]   .message-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;position:absolute;left:16px;top:16px}.message-card[_ngcontent-%COMP%]   .message-meta[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{color:#6b7280;font-size:14px}.message-card[_ngcontent-%COMP%]   .message-meta[_ngcontent-%COMP%]   .unread-count[_ngcontent-%COMP%]{background:#ef4444;color:#fff;font-size:12px;font-weight:700;min-width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:999px;padding:0 6px}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.avatar-container[_ngcontent-%COMP%]{position:relative}.avatar-container[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:999px;object-fit:cover;background-color:#f3f4f6}.avatar-container[_ngcontent-%COMP%]   .online-indicator[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;width:14px;height:14px;background-color:#10b981;border-radius:999px;border:2px solid white}.user-details[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-weight:700;color:#111827;margin-bottom:4px}.user-details[_ngcontent-%COMP%]   .user-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:14px;color:#6b7280}.user-details[_ngcontent-%COMP%]   .user-meta[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.user-details[_ngcontent-%COMP%]   .user-meta[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fbbf24}.user-details[_ngcontent-%COMP%]   .user-meta[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{color:#d1d5db}.user-details[_ngcontent-%COMP%]   .user-meta[_ngcontent-%COMP%]   .job-count[_ngcontent-%COMP%]{color:#9ca3af}.message-preview[_ngcontent-%COMP%]{color:#4b5563;margin-top:8px;font-size:14px;line-height:1.5;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}.message-preview.unread-message[_ngcontent-%COMP%]{font-weight:500}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:calc(100vh - 400px);padding:2rem;text-align:center}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{width:80px;height:80px;margin-bottom:1.5rem;color:#e5e7eb}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:5rem;color:#d1d5db}.empty-state[_ngcontent-%COMP%]   .empty-text[_ngcontent-%COMP%]{font-size:1.125rem;color:#6b7280;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   .empty-subtext[_ngcontent-%COMP%]{font-size:.875rem;color:#9ca3af;max-width:300px;line-height:1.5}']})}}return a})();var Ei=(()=>{class a{static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275mod=q({type:a})}static{this.\u0275inj=L({imports:[Mt,se,_e,Pe,Ie,oe.forChild([{path:"",component:De},{path:":id",component:Te}])]})}}return a})();export{Ei as MessagesModule};
