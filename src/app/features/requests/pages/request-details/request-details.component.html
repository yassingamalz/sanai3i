<div class="min-h-screen bg-gray-50 pb-24">
        <!-- Header -->
        <header class="header">
            <app-back-button [redirectUrl]="'}/requests'" text="رجوع"></app-back-button>
            <div class="text-center text-white text-xl font-bold mb-4">
                تفاصيل الطلب #{{request?.id}}
            </div>
        </header>
    
    <!-- Main Content -->
    <div class="relative z-10 -mt-6">
        <!-- Request Details Section -->
        <div class="p-4">
            <div class="custom-card">
                <div class="p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="section-title">تفاصيل الطلب</h3>
                        <span class="text-sm text-gray-600">طلب رقم #{{request?.id}}</span>
                    </div>

                    <!-- Status Banner -->
                    <div class="status-banner" [class]="getStatusClass(request?.status)">
                        <span>{{getStatusLabel(request?.status)}}</span>
                    </div>

                    <!-- Service Info -->
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900 mb-1">{{request?.service}}</h3>
                            <div class="info-text">
                                <i class="fas fa-map-marker-alt"></i>
                                {{request?.location?.address}}
                            </div>
                        </div>
                        <div class="text-left" *ngIf="request?.worker">
                            <div class="rating-badge">
                                <i class="fas fa-star"></i>
                                <span>{{request?.worker?.rating}}</span>
                            </div>
                            <div class="completed-jobs">
                                {{request?.worker?.completedJobs}} خدمة منفذة
                            </div>
                        </div>
                    </div>

                    <!-- Timing Info -->
                    <div class="info-text mb-4">
                        <i class="fas fa-clock"></i>
                        <span>{{request?.scheduledTime}} • {{request?.scheduledDate}}</span>
                    </div>

                    <!-- Description -->
                    <p class="text-gray-700 mb-4">{{request?.description}}</p>

                    <!-- Photos Grid -->
                    <div class="photos-grid">
                        <img *ngFor="let image of request?.images; trackBy: trackByFn" [src]="image"
                            [alt]="request?.service" [class.loading]="imageLoadingStates[image]"
                            [class.loaded]="!imageLoadingStates[image]" (load)="onImageLoad(image)"
                            (error)="handleImageError(image)" class="photo-item">
                    </div>

                    <!-- Initial Cost Preview -->
                    <div class="flex justify-between items-center border-t pt-4">
                        <div class="price-text">
                            {{request?.estimatedCost}} جنيه
                        </div>
                        <button *ngIf="showTrackingButton" (click)="toggleTracking()" class="track-btn"
                            [class.tracking-active]="isTrackingActive">
                            <i class="fas fa-location-arrow"></i>
                            <span>تتبع الموقع</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Service Provider Details -->
        <div class="p-4">
            <div class="custom-card">
                <div class="p-4">
                    <h3 class="section-title">مقدم الخدمة</h3>

                    <!-- Provider Header -->
                    <div class="provider-header">
                        <img [src]="request?.worker?.image" [alt]="request?.worker?.name" class="provider-image">
                        <div class="flex-1">
                            <h4 class="provider-name">{{request?.worker?.name}}</h4>
                            <p class="provider-bio">{{request?.worker?.bio}}</p>
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-item">
                            <i class="fas fa-star text-yellow-400"></i>
                            <div class="stat-value">{{request?.worker?.rating}}</div>
                            <div class="stat-label">التقييم</div>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-award text-blue-400"></i>
                            <div class="stat-value">{{request?.worker?.completionRate}}</div>
                            <div class="stat-label">نسبة الإكمال</div>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-comment text-green-400"></i>
                            <div class="stat-value">{{request?.worker?.responseRate}}</div>
                            <div class="stat-label">نسبة الرد</div>
                        </div>
                    </div>

                    <!-- Contact Buttons -->
                    <div class="contact-buttons">
                        <button class="contact-btn" (click)="handleAction('call')">
                            <i class="fas fa-phone"></i>
                            <span>اتصال</span>
                        </button>
                        <button class="contact-btn" (click)="handleAction('chat')">
                            <i class="fas fa-comment"></i>
                            <span>محادثة</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cost Summary -->
        <div class="p-4">
            <div class="custom-card">
                <div class="p-4">
                    <h3 class="section-title">ملخص التكاليف</h3>

                    <!-- Summary Items -->
                    <div class="cost-summary">
                        <div class="cost-item">
                            <span>تكلفة الخدمة</span>
                            <span>{{costBreakdown.basePrice}} جنيه</span>
                        </div>
                        <div class="cost-item">
                            <span>ضريبة القيمة المضافة (14%)</span>
                            <span>{{costBreakdown.vat | number:'1.2-2'}} جنيه</span>
                        </div>
                        <div class="cost-item">
                            <span>رسوم الخدمة</span>
                            <span>{{costBreakdown.serviceFee}} جنيه</span>
                        </div>
                        <div class="cost-item discount">
                            <span>خصم</span>
                            <span>-{{costBreakdown.discount}} جنيه</span>
                        </div>
                    </div>

                    <div class="border-t border-dashed my-4"></div>

                    <!-- Total -->
                    <div class="total-section">
                        <div>
                            <h4 class="total-label">الإجمالي</h4>
                            <p class="total-subtitle">شامل الضريبة</p>
                        </div>
                        <span class="total-amount">{{costBreakdown.total | number:'1.2-2'}} جنيه</span>
                    </div>

                    <!-- Payment Method -->
                    <div class="payment-method">
                        <span class="text-gray-600">طريقة الدفع</span>
                        <div class="payment-type">
                            <i class="fas fa-money-bill text-gray-400"></i>
                            <span>{{getPaymentMethodLabel(request?.paymentMethod)}}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Actions -->
    <div class="bottom-actions">
        <button class="action-btn primary" (click)="handleAction('support')">
            <i class="fas fa-headset"></i>
            <span>تواصل مع الدعم</span>
        </button>
        <button *ngIf="canCancel" class="action-btn secondary" (click)="handleAction('cancel')">
            إلغاء الطلب
        </button>
    </div>
</div>