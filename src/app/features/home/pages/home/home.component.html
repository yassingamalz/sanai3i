<!-- Header Section -->
<header class="bg-[#ef4444]">
  <div class="px-4 pt-8 pb-3">
    <div class="search-container">
      <div class="bg-white rounded-full flex items-center h-11 shadow-sm relative">
        <span class="flex-1 text-gray-700 text-sm mr-4 text-right relative">
          <input 
            type="text" 
            class="search-input w-full pr-10 pl-4" 
            [placeholder]="'البحث عن خدمة'"
            [(ngModel)]="searchQuery"
            (input)="onSearch($event)"
            (focus)="showResults = true"
          >
          <i *ngIf="!isSearching" class="fas fa-search text-gray-400 absolute right-3 top-1/2 -translate-y-1/2"></i>
          <div *ngIf="isSearching" class="search-spinner absolute right-3 top-1/2 -translate-y-1/2"></div>
          <i *ngIf="searchQuery" 
             class="fas fa-times text-gray-400 absolute left-3 top-1/2 -translate-y-1/2 cursor-pointer" 
             (click)="clearSearch()">
          </i>
        </span>
        <div class="flex items-center ml-4">
          <i class="fas fa-home text-[#ef4444] text-lg"></i>
          <span class="text-[#ef4444] mr-2 font-medium">الرئيسية</span>
        </div>
      </div>

      <!-- Search Results Dropdown -->
      <div *ngIf="showResults && (isSearching || searchResults.length > 0 || searchQuery)" 
           class="search-results-dropdown">
        <!-- Loading State -->
        <ng-container *ngIf="isSearching">
          <div class="search-result-item shimmer" *ngFor="let i of [1,2,3]">
            <div class="skeleton-icon"></div>
            <div class="flex-1">
              <div class="skeleton-text w-3/4"></div>
              <div class="skeleton-text w-1/2"></div>
            </div>
          </div>
        </ng-container>

        <!-- Results -->
        <ng-container *ngIf="!isSearching && searchResults.length > 0">
          <div *ngFor="let result of searchResults; let i = index; trackBy: trackBySearchResult" 
               class="search-result-item"
               [class.selected]="i === selectedResultIndex"
               (mouseenter)="selectedResultIndex = i"
               (click)="navigateToSubService(result.mainServiceId, result.id)">
            <i [class]="getMainService(result.mainServiceId)?.faIcon || 'fas fa-circle'" 
               class="service-icon"></i>
            <div class="flex-1">
              <h4 class="result-title">{{result.name}}</h4>
              <p class="result-subtitle">
                <span class="main-service-name">{{getMainService(result.mainServiceId)?.name}}</span>
                <span class="separator">•</span>
                <span class="price">{{result.price}} جنيه</span>
              </p>
            </div>
          </div>
        </ng-container>

        <!-- No Results -->
        <div *ngIf="!isSearching && searchResults.length === 0 && searchQuery" 
             class="no-results">
          <i class="fas fa-search text-gray-400 mb-2 text-lg"></i>
          <p>لا توجد نتائج تطابق بحثك</p>
          <p class="text-sm text-gray-500 mt-1">حاول البحث بكلمات مختلفة</p>
        </div>
      </div>
    </div>
  </div>
</header>

<app-featured-slider></app-featured-slider>
<!-- All Services Section -->
<section class="content-section">
  <div class="section-header">
    <div class="header-content">
      <h2 class="section-title">كل الخدمات</h2>
      <div class="header-icons" (click)="navigateToFullList('all-services')">
        <i class="fas fa-chevron-left"></i>
      </div>
    </div>
  </div>
  <div class="services-grid">
    <!-- Loading State -->
    <ng-container *ngIf="isLoading">
      <div class="skeleton-grid-card" *ngFor="let item of [1,2,3,4,5,6]">
        <div class="skeleton-icon shimmer"></div>
        <div class="skeleton-text shimmer w-2/3 mx-auto"></div>
        <div class="skeleton-text shimmer w-3/4 mx-auto"></div>
      </div>
    </ng-container>
    
    <!-- Loaded State with Animation -->
    <ng-container *ngIf="!isLoading">
      <div *ngFor="let service of services; let i = index; trackBy: trackByServiceId" 
           #serviceCard
           class="grid-card"
           (click)="openService(service.id)"
           [@fadeInUp]="shouldAnimate(i) ? 'in' : 'void'">
        <div class="service-icon">{{service.icon}}</div>
        <h3 class="card-title">{{service.name}}</h3>
        <p class="card-subtitle">{{service.description}}</p>
      </div>
    </ng-container>
  </div>
</section>

<!-- Top Workers Section -->
<section class="content-section">
  <div class="section-header">
    <div class="header-content">
      <h2 class="section-title">أفضل الصنايعية</h2>
      <div class="header-icons">
        <i class="fas fa-chevron-left"></i>
      </div>
    </div>
  </div>
  <div class="cards-container">
    <!-- Loading State -->
    <ng-container *ngIf="isLoading">
      <div class="worker-card" *ngFor="let item of [1,2,3]">
        <div class="skeleton-circle shimmer"></div>
        <div class="flex-1">
          <div class="skeleton-text shimmer w-2/3"></div>
          <div class="skeleton-text shimmer w-1/2"></div>
          <div class="skeleton-text shimmer w-1/3"></div>
        </div>
      </div>
    </ng-container>

    <!-- Loaded State -->
    <ng-container *ngIf="!isLoading">
      <div *ngFor="let worker of topWorkers; trackBy: trackByWorkerId" class="worker-card"
        (click)="onWorkerClick(worker)">
        <img [src]="worker.image" [alt]="worker.name" class="worker-image" />
        <div class="worker-info">
          <h3 class="card-title">{{worker.name}}</h3>
          <p class="card-subtitle">{{worker.service}}</p>
          <div class="rating">
            <i class="fas fa-star"></i>
            <span>{{worker.rating}} • {{worker.completedJobs}} خدمة</span>
          </div>
        </div>
        <i class="fas fa-chevron-right arrow-icon"></i>
      </div>
    </ng-container>
  </div>
</section>

<!-- Top Services Section -->
<section class="content-section">
  <div class="section-header">
    <div class="header-content">
      <div class="header-title">
        <h2 class="section-title">الخدمات الأكثر طلباً</h2>
        <span class="request-count" *ngIf="!isLoading">{{topSubServices[0].totalRequests || 0}} طلب</span>
      </div>
      <div class="header-icons">
        <i class="fas fa-chevron-left"></i>
      </div>
    </div>
  </div>
  <div class="cards-container">
    <!-- Loading State -->
    <ng-container *ngIf="isLoading">
      <div class="skeleton-card" *ngFor="let item of [1,2,3]">
        <div class="service-content">
          <div class="skeleton-text shimmer w-2/3"></div>
          <div class="skeleton-text shimmer w-1/4"></div>
        </div>
      </div>
    </ng-container>
    
    <!-- Loaded State -->
    <ng-container *ngIf="!isLoading">
      <div *ngFor="let subService of topSubServices; trackBy: trackBySubServiceId" 
           class="service-card" 
           (click)="navigateToSubService(subService.mainServiceId, subService.id)">
        <div class="service-content">
          <div class="service-info">
            <div class="flex items-center gap-2">
              <i [class]="getMainService(subService.mainServiceId)?.faIcon" class="text-[#ef4444]"></i>
              <h3 class="card-title">{{subService.name}}</h3>
            </div>
            <div class="flex items-center gap-2 mt-1">
              <span class="request-count">{{subService.totalRequests}} طلب</span>
              <span class="text-sm text-gray-500">•</span>
              <span class="text-sm text-gray-500">{{getMainService(subService.mainServiceId)?.name}}</span>
            </div>
          </div>
          <div class="trend-container">
            <i class="fa-solid" 
               [class.fa-arrow-trend-up]="subService.trend === 'up'"
               [class.fa-arrow-trend-down]="subService.trend === 'down'"
               [class.text-success]="subService.trend === 'up'"
               [class.text-danger]="subService.trend === 'down'">
            </i>
            <span class="trend-value" 
                  [class.text-success]="subService.trend === 'up'"
                  [class.text-danger]="subService.trend === 'down'">
              {{subService.trendValue}}%
            </span>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</section>